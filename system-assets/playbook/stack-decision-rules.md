# 技术栈决策规则（可审计）

## 默认推荐组合
- 前端：小程序原生 +（可选）H5 WebView 承载
- 后端：CloudBase 云函数（HTTP 触发）
- 存储：COS + CloudBase Storage
- 鉴权：微信登录（如需要）
- LLM：国内可用模型（腾讯混元 / 火山·豆包）
- 可观测：traceId + 统一错误码 + 日志字段
- 回退策略：不可用时返回可解释降级结果

## 触发条件与切换规则
### 大文件上传（≥10MB）
- 禁止：base64 走 JSON 进云函数
- 选择：客户端直传 COS 或分片上传 COS
- 云函数仅接收：cosKey + metadata

### 耗时任务（>10s）
- 选择：异步任务队列/延迟处理
- 兜底：轮询 + jobId

### 强实时（<3s）且模型不稳定
- 选择：先返回结构化占位结果 + 后补齐

### 需要稳定公网回调/长连接/复杂路由
- 选择：CloudBase Run（容器）优先
- 云函数仅做轻接口

### 合规必须国内
- 禁止：Firebase/Vercel/海外模型默认路径
- 选择：国内云 + 国内模型 + 国内对象存储

## 成本确认规则
触发 Human（成本支出确认）条件：
- 新增付费第三方（短信、OCR、付费模型、大流量 CDN、付费队列）
- 预计月成本 > ¥500

否则：默认按免费额度/最低配置推进。
