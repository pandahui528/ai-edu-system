# 技术栈决策规则（v0.2，可审计）

## 默认方案（最稳 + 最省时间）
- 前端：小程序原生 +（可选）H5 WebView 承载
- 后端：CloudBase 云函数（HTTP 触发）
- 存储：COS（大文件/图片/视频）+ CloudBase Storage（轻量）
- 鉴权：微信登录（如需要）
- LLM：国内可用（腾讯混元 / 火山·豆包）
- 可观测：统一日志字段 + traceId + 错误码规范
- 回退：不可用时返回可解释降级结果

## 触发条件与规则
### 1) 大文件上传（≥10MB）
- 禁止：把文件/图片 base64 走 JSON 进云函数
- 选择：客户端直传 COS 或分片上传 COS
- 云函数仅接收：cosKey + metadata

### 2) 时延 async
- 启用 jobs 模式：jobId + 轮询查询
- 云函数只接收 cosKey，不接收文件本体

### 3) 强实时 instant 且模型不稳定
- 启用降级策略：先返回结构化占位结果 + 后补齐

### 4) 复杂路由 / 长连接 / 稳定公网回调
- 运行时切换为 CloudBase Run（容器）优先
- 云函数仅做轻接口

### 5) 合规 china_required
- 选择：国内云 + 国内模型 + 国内对象存储
- 禁止：Firebase/Vercel/海外模型默认路径
